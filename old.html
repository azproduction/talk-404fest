<!DOCTYPE HTML>
<html lang="ru">
<head>
	<title>Backbone и BE*</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=1274, user-scalable=no">
	<link rel="stylesheet" href="styles/screen.css">
	<link rel="stylesheet" href="styles/print.css" media="print">

    <link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/idea.min.css">
</head>
<body class="list">
	<header class="caption">
		<h1>Backbone и BE*</h1>
		<p><a href="http://twitter.com/olmokhov_ru">Олег Мохов</a>, <a href="http://twitter.com/azproduction">Михаил Давыдов</a></p>
	</header>

	<section class="slide null">
		<img src="images/yandex.svg" class="yandex"/>
	</section>

    <section class="slide first"><div class="arrow">
    	<img src="images/yandex.svg" class="yandex"/>
		<h2>Backbone и BE*</h2>
        <div class="info">
            <p class="author">Олег Мохов и Михаил Давыдов</p>
            <p class="author">разработчики из Ебурга</p>
            <p class="author">4 октября 2013, пЯТЬница, Москва</p>
        </div>
    </div></section>
    <section class="slide first"><div class="arrow">
    	<img src="images/yandex.svg" class="yandex"/>
		<h2>Backbone и BEM</h2>
        <div class="info">
            <p class="author">Олег Мохов и Михаил Давыдов</p>
            <p class="author">разработчики из Ебурга</p>
            <p class="author">4 октября 2013, пЯТЬница, Москва</p>
        </div>
    </div></section>

    <section class="slide cover h w c">
        <h2>Зачем?</h2>
        <img src="pictures/mokhov/why.jpg"/>
    </section>

    <section class="slide cover w c">
   		<h2>Новый сервис</h2>
        <img src="pictures/mokhov/store-image.png"/>
   	</section>
    <section class="slide shout">
        <h2>MVC</h2>
    </section>
    <section class="slide">
        <h2>MVC нет в BEM</h2>
   		<ul>
            <li>BEM-MVC на тот момент в разработке</li>
            <li>DIY</li>
   		</ul>
   	</section>

    <section class="slide cover w c">
   		<h2>Эксперимент</h2>
        <img src="pictures/mokhov/experiments.jpg"/>
   	</section>

    <section class="slide cover w c">
        <h2>Выбираем</h2>
        <div><img src="pictures/mokhov/choice.png"/></div>
   	</section>
    <section class="slide">
        <h2>Почему Backbone?</h2>
        <ul>
            <li>Простота</li>
            <li class="next">Большое комьюнити</li>
            <li class="next">Куча модулей</li>
            <li class="next">Гибкость</li>
        </ul>
   	</section>
    <section class="slide">
        <h2>Не Framework</h2>
        <ul>
            <li>Framework over Framework: BEM – уже фреймворк</li>
            <li>В Яндексе есть свой подход к разработке (BEM)</li>
        </ul>
   	</section>
    <section class="slide cover w c">
        <h2>Много данных</h2>
        <iframe style="position: absolute; top: 0; left: 0; z-index: -1;" width="100%" height="100%" src="https://developer.store.yandex.ru"></iframe>
   	</section>
    <section class="slide">
   		<h2>SPA</h2>
        <ul>
            <li>Админка = ярко-выраженный REST</li>
            <li>Модели в Backbone привязаны к ручкам</li>
            <li>Router</li>
        </ul>
   	</section>
    <section class="slide">
        <h2>View ≠ реализация</h2>
        <ul>
            <li>View в Backbone – это интерфейс</li>
            <li>Backbone предлагает шаблонизировать через Underscore Template</li>
            <li>Но, при этом, не навязывает этот подход</li>
        </ul>
   	</section>
    <section class="slide cover w c">
   		<h2>Первый подход</h2>
        <img src="pictures/mokhov/first-try.jpg"/>
   	</section>


    <section class="slide shout">
        <h2>♕BEM + Backbone</h2>
    </section>
    <section class="slide">
        <h2>BemView - абстрактная вьюха</h2>
<pre class="l-7 javascript">
        <code>var BemView = Backbone.View.extend({</code>
        <code>render: function(){</code>
        <code>    var html = BEMHTML.apply(this.tpl(arguments));</code>

        <code>    BEM.DOM[!!this.insert ? 'append': 'update']</code>
        <code>           (this.$el, html);</code>
        <code>    this.afterRender();</code>
        <code>    }</code>
        <code>});</code>
</pre>
    </section>
    <section class="slide">
        <h2>BemAjaxView - BemView с Ajax'ом</h2>
<pre class="l-7 javascript">
        <code>var BemAjaxView = BemView.extend({</code>
        <code>    initialize: function(args){</code>
        <code>        this.model.on( 'change', this.render, this );</code>
        <code>    }</code>
        <code>});</code>
</pre>
    </section>
    <section class="slide">
        <h2>Немножко под капотом</h2>
        <ul>
            <li>b-page.js == index.js</li>
            <li>Контейнер блоков (BEM.DOM.decl)</li>
            <li>Страница – несколько больших блоков</li>
            <li>Блоки слушают Router и в зависимости от этого
                <ul>
                    <li>Показываются/скрываются</li>
                    <li>или решают подтянуть новые данные</li>
                    <li>или обновляются</li>
                </ul>
            </li>
        </ul>
    </section>

    <section class="slide">
        <h2>Например, b-page</h2>
        <pre class="l-7 javascript small">
            <code>BEM.DOM.decl('b-page', {</code>
            <code>    onSetMod: {</code>
            <code>        'js': function(){</code>
            <code>            var launch = Backbone.ajax({</code>
            <code>                url: '/api/launch',</code>
            <code>                dataType: 'json'</code>
            <code>            }).done(function(data){</code>
            <code>                I18N.lang(data.language);</code>
            <code>                app.getProducts().fetch();</code>
            <code>                appView = new AppView({ model: app });</code>
            <code>                appView.render();</code>
            <code>            });</code>
            <code>        }</code>
            <code>    }</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Взаимодействие с моделями</h2>
        <ul>
            <li>Через View</li>
            <li>Достаём из глобального объекта</li>
            <li>Модели завязаны на данные, а View на вёрстку и не всегда очевидно, какая модель соответствует данному view</li>
        </ul>
    </section>

    <section class="slide cover w c">
   		<h2>But it works!</h2>
        <img src="pictures/mokhov/it-works.jpg"/>
    </section>
    <section class="slide shout">
   		<h2>Проблемы</h2>
    </section>
    <section class="slide cover w c">
        <h2>View подчиняет модели</h2>
        <img src="pictures/mokhov/view-model.jpg"/>
    </section>
    <section class="slide cover w c">
   		<h2>Нет контроллеров</h2>
        <img src="pictures/mokhov/conductor.jpg"/>
   	</section>
    <section class="slide cover w c">
   		<h2>Всё в глобальном namespace</h2>
        <img src="pictures/mokhov/global.png"/>
    </section>
    <section class="slide cover w c">
   		<h2>Всё BEM-блоки</h2>
        <img src="pictures/mokhov/all-blocks.jpg"/>
    </section>

    <section class="slide cover w c">
   		<h2>Второй подход</h2>
        <img src="pictures/mokhov/first-try.jpg"/>
   	</section>
    <section class="slide shout">
   		<h2>♕Backbone + BEM</h2>
    </section>


<!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->


    <section class="slide cover h w c">
   		<h2>Совсем новый проект</h2>
        <img src="pictures/iphone-taxi.png"/>
    </section>

    <section class="slide shout">
   		<h2>Нужно пересмотреть архитектуру</h2>
    </section>

    <section class="slide cover w c">
        <h2>Bem-make → Enb</h2>
        <img src="pictures/mokhov/Mavrodi.jpg"/>
    </section>

    <section class="slide cover h c">
   		<h2>Всё блоки</h2>
        <img src="pictures/block.png"/>
    </section>

    <section class="slide">
   		<h2>Всё блоки</h2>
        <ul>
            <li>Model - блок с данными</li>
            <li>Collection - блок</li>
            <li>View - блок интерфейса</li>
            <li>Утилиты - блоки</li>
            <li>Блоки, блоки, блоки...</li>
        </ul>
    </section>

    <section class="slide cover w h">
        <img src="pictures/calculator.jpg"/>
        <img src="pictures/minecraft-calc-back.png" class="next"/>
    </section>

    <section class="slide shout">
   		<h2>BEM &mdash; WebComponents</h2>
    </section>

    <section class="slide cover w c">
        <img src="pictures/datepicker.png"/>
    </section>

    <section class="slide">
   		<h2>Пример: b-date-picker</h2>
        <ul>
            <li>Не общается с другими блоками</li>
            <li>Ведет себя как 1 элемент</li>
            <li>Инкапсуляция 3 селектов</li>
            <li>Привычный интерфейс доступа</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Пример: b-date-picker</h2>
        <pre class="l-7 javascript">
            <code>$('.b-date-picker').bem('b-date-picker');</code>
            <code>datePicker.val(new Date());</code>
            <code>datePicker.val();</code>
            <code>datePicker.setTimeZone('+0400');</code>
            <code>datePicker.on('change', function (e) {</code>
            <code>    console.log(e);</code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide shout">
   		<h2>Model, View &mdash; модули</h2>
    </section>

    <section class="slide">
   		<h2>Не было модулей</h2>
        <ul>
            <li>Все в глобалах</li>
            <li>Сложно искать зависимости</li>
            <li>Сложнее понять интерфейс модуля</li>
            <li>Не удобно реиспользовать</li>
        </ul>
    </section>

    <section class="slide">
   		<h2>CommonJS Модули и LMD</h2>
        <ul>
            <li>CommonJS
                <ul>
                    <li>удобнее AMD</li>
                    <li>Node.js-friendly</li>
                </ul>
            </li>
            <li>LMD
                <ul>
                    <li>CJS в браузере</li>
                    <li>организация сборок</li>
                    <li>сборка модулей</li>
                </ul>
            </li>
        </ul>
    </section>

    <section class="slide">
   		<h2>Сборка</h2>
        <ul>
            <li>Компоненты отдельно (BEM, ENB)</li>
            <li>Логика отдельно (CJS, LMD)</li>
            <li>Grunt
                <ul>
                    <li>grunt-jshint</li>
                    <li>grunt-jscs</li>
                    <li>grunt-lmd</li>
                    <li>grunt-enb</li>
                </ul>
            </li>
        </ul>
    </section>

    <section class="slide shout">
   		<h2>BEMJSON</h2>
    </section>

    <section class="slide">
   		<h2>BEMJSON</h2>
        <ul>
            <li>Мета-шаблон</li>
            <li class="next">Генерация css, js</li>
            <li class="next">Генерация шаблонов</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Мета-шаблон</h2>
        <pre class="l-7 javascript">
            <code>{</code>
            <code>    "block": <mark>"button"</mark>,</code>
            <code>    "bind": {</code>
            <code>        "value": "i18n.click_me"</code>
            <code>    }</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide shout">
        <h2>$ grunt enb</h2>
    </section>

    <section class="slide">
        <h2>На выходе CSS</h2>
        <pre class="l-7 css">
            <code>.button {</code>
            <code>    border-radius: 5px;</code>
            <code>    background: #fff;</code>
            <code>}</code>
            <code>.button_state_active {</code>
            <code>    outline: 2px solid #f7f21a;</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
        <h2>На выходе JS</h2>
        <pre class="l-7 javascript">
            <code>// ...</code>
            <code>this.bindTo('mouseover', function () {</code>
            <code>    this.setMod('state', 'active');</code>
            <code>});</code>
            <code>this.bindTo('mouseout', function () {</code>
            <code>    this.delMod('state');</code>
            <code>});</code>
            <code>// ...</code>
        </pre>
    </section>

    <section class="slide">
        <h2>На выходе Шаблон(ы)</h2>
        <pre class="l-7 xml">
            <code>&lt;!--dom-template--&gt;</code>
            <code>&lt;button class="button" data-value="i18n.click_me"&gt;</code>
        </pre>
        <pre class="l-7 xml next">
            <code>{{! handlebars }}</code>
            <code>&lt;button class="button"&gt;{{ i18n.click_me }}&lt;/button&gt;</code>
        </pre>
        <pre class="l-7 php next">
            <code>// php</code>
            <code>&lt;button class="button"&gt;&lt;?=$i18n-&gt;click_me?&gt;&lt;/button&gt;</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>View слишком суетливые</h2>
        <pre class="l-7 javascript">
            <code>$el.on('input', function (e) {</code>
            <code>    model.set('data', this.value);</code>
            <code>});</code>
            <code>model.on('change:data', function (model, value) {</code>
            <code>    $el.val(value);</code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>DOM-шаблоны</h2>
        <ul>
            <li>Легче View</li>
            <li>Связывание Данных и DOM</li>
            <li>Data-driven</li>
        </ul>
    </section>

    <section class="slide">
   		<h2>Rivets.js</h2>
        <ul>
            <li>Простой синтаксис</li>
            <li>Весит мало</li>
            <li>Лишнего не просит</li>
            <li>Написали Rivets-Backbone адаптер</li>
            <li>Легко написать адаптер под BEMJSON</li>
        </ul>
    </section>

    <section class="slide">
   		<h2>Rivets.js шаблон в BEMJSON</h2>
        <pre class="l-7 javascript">
            <code>{</code>
            <code>    "block": "list",</code>
            <code>    <mark>"bind"</mark>: {</code>
            <code>        "each-item": "list"</code>
            <code>    },</code>
            <code>    ...</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>Rivets.js шаблон</h2>
        <pre class="l-7 xml">
            <code>&lt;ul class="list"&gt;</code>
            <code>    &lt;li <mark>data-each-item="list"</mark>&gt;</code>
            <code>        &lt;input <mark>data-value="item.value | filter"</mark>/&gt;</code>
            <code>    &lt;/li&gt;</code>
            <code>&lt;/ul&gt;</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>BEMHTML для Rivets.js</h2>
        <pre class="l-7 javascript">
            <code>// ...</code>
            <code>var bind = this.ctx.bind;</code>
            <code>return Object.keys(bind).reduce(function (attrs, name) {</code>
            <code>    attrs['data-' + binding] = bind[binding];</code>
            <code>    return attrs;</code>
            <code>}, this.ctx.attrs || {});</code>
            <code>// ...</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>Живой пример: Geosuggest</h2>
        <pre class="l-7 javascript small">
            <code>{</code>
            <code>    elem: 'item',</code>
            <code>    bind: {</code>
            <code>        'each-object': 'geosuggest.objects',</code>
            <code>        'id': 'object:cid'</code>
            <code>    },</code>
            <code>    content: [{</code>
            <code>        elem: 'distance',</code>
            <code>        bind: {</code>
            <code>            'text': 'object.distance | distanceKm 2 км'</code>
            <code>        }</code>
            <code>    }, /* ... */]</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
   		<h2>Живой пример: Geosuggest</h2>
        <pre class="l-7 javascript">
            <code>var GeoSuggestView = Backbone.View.extend({</code>
            <code>    layout: <mark>require('geoGuggestTemplate')</mark>,</code>
            <code>    initialize: function (viewModel) {</code>
            <code>        this.setElement(this.layout);</code>
            <code>        <mark>rivets.bind(this.el, this.model);</mark></code>
            <code>    }, // ... </code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Выводы</h2>
        <ul>
            <li>Backbone – добро!</li>
            <li>BEM – это про UI</li>
            <li>data-bind</li>
            <li>BEMJSON – сила!</li>
        </ul>
    </section>
    <section class="slide cover c">
   		<h2>Скоро будет редизайн</h2>
        <img src="pictures/big-taxi.png"/>
        <img src="pictures/the-new-taxi.png" class="next"/>
    </section>

    <section class="slide">
   		<h2>Реиспользование модулей</h2>
        <ul>
            <li>Models</li>
            <li>Controllers</li>
            <li>Utils</li>
            <li>Пакеты с модулями</li>
            <li>Подключение зависимостей</li>
        </ul>
    </section>

    <section class="slide cover c">
   		<img src="pictures/bower-logo.png"/>
    </section>


    <section class="slide shout">
   		<h2>Экспериментируйте!</h2>
    </section>

    <div class="slide last">
        <img src="images/yandex.svg" class="yandex"/>
        <h2>Backbone и BE*</h2>
        <div class="info">
            <p class="author">Олег Мохов и Михаил Давыдов</p>
            <p class="author">Разработчики из Ебурга</p>
            <p class="author social">
                <a href="http://habrahabr.ru/users/Olegbl4"><img src="pictures/js.svg" alt=""/></a><a href="http://github.com/mokhov"><img src="pictures/github.svg" alt=""/></a><a href="http://twitter.com/olmokhov_ru"><img src="pictures/twitter.svg" alt=""/></a><a href="http://twitter.com/olmokhov_ru">@olmokhov_ru</a>
            </p>
            <p class="author social">
                <a href="http://habrahabr.ru/users/azproduction"><img src="pictures/js.svg" alt=""/></a><a href="http://github.com/azproduction"><img src="pictures/github.svg" alt=""/></a><a href="http://twitter.com/azproduction"><img src="pictures/twitter.svg" alt=""/></a><a href="http://twitter.com/azproduction">@azproduction</a>
            </p>
        </div>
    </div>

    <section class="slide">
   		<h2>Ссылки</h2>
        <ul>
            <li><a href="http://backbonejs.org/">Backbone.js</a></li>
            <li><a href="http://rivetsjs.com/">Rivets.js</a></li>
            <li><a href="https://github.com/azproduction/rivets-backbone-adapter">Rivets-Backbone</a></li>
            <li><a href="http://habrahabr.ru/post/177115/">Сравнение Angular, Backbone, CanJS и Ember</a></li>
            <li><a href="https://github.yandex-team.ru/yastore/developer-console-www">Репозиторий DevConsole</a></li>
            <li><a href="https://github.yandex-team.ru/taxi/frontend-2.0">Репозиторий Такси</a></li>
        </ul>
   	</section>

    <section class="slide cover c qr-code">
        <a href="http://clck.ru/102R">clck.ru/102R</a>
        <img src="http://qr.yandex.net/?action=generate&text=http://clck.ru/102R" alt="">
   	</section>

	<div class="progress"><div></div></div>

    <script src="http://yandex.st/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
    <script src="js/shower/shower.min.js"></script>
    <script src="js/index.js"></script>
</body>
</html>
